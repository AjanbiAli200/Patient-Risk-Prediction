{"dbt_gold_models.sql": {"content": "-- dim_date.sql\n\n{{ config(materialized='table') }}\n\n-- Generate a date dimension covering the full range of your dataset\nWITH date_range AS (\n    SELECT\n        sequence(\n            to_date('2010-01-01'),\n            to_date('2030-12-31'),\n            interval 1 day\n        ) AS date_seq\n),\n\nexploded AS (\n    SELECT explode(date_seq) AS full_date FROM date_range\n),\n\nfinal AS (\n    SELECT\n        full_date,\n        year(full_date) AS year,\n        quarter(full_date) AS quarter,\n        month(full_date) AS month,\n        day(full_date) AS day,\n        weekofyear(full_date) AS week_of_year,\n        date_format(full_date, 'MMMM') AS month_name,\n        date_format(full_date, 'EEEE') AS day_name,\n        CASE \n            WHEN dayofweek(full_date) IN (1,7) THEN 'Weekend'\n            ELSE 'Weekday'\n        END AS day_type,\n        concat('Q', quarter(full_date)) AS quarter_name,\n        make_date(year(full_date), month(full_date), 1) AS month_start,\n        last_day(full_date) AS month_end\n    FROM exploded\n)\n\nSELECT\n    ROW_NUMBER() OVER (ORDER BY full_date) AS date_sk,  -- \u2705 Sequential surrogate key\n    *\nFROM final\nORDER BY full_date;\n\n\n-- dim_doctor.sql\n\n{{ config(materialized='table') }}\n\nWITH base AS (\n    SELECT\n        doctor,\n        hospital,\n        COUNT(DISTINCT medical_condition) AS conditions_treated,\n        COUNT(*) AS total_patients\n    FROM {{ source(\"source_silver\",\"healthcare\") }}\n    GROUP BY 1,2\n)\nSELECT\n    row_number() OVER (ORDER BY md5(concat(doctor, hospital))) AS doctor_sk,\n    doctor,\n    hospital,\n    conditions_treated,\n    total_patients\nFROM base;\n\n\n-- dim_hospital.sql\n\n{{ config(materialized='table') }}\n\nWITH base AS (\n    SELECT DISTINCT\n        TRIM(hospital) AS hospital,\n        TRIM(REGEXP_SUBSTR(hospital, '^[^,\\\\-]+')) AS parent_hospital\n    FROM {{ source(\"source_silver\", \"healthcare\") }}\n    WHERE hospital IS NOT NULL\n)\n\nSELECT\n    ROW_NUMBER() OVER (ORDER BY parent_hospital, hospital) AS hospital_sk,\n    parent_hospital,\n    hospital\nFROM base;\n\n\n-- dim_patient.sql\n\n{{ config(materialized='table') }}\n\nWITH base AS (\n    SELECT DISTINCT\n        name AS patient_name,\n        gender,\n        blood_type,\n        medical_condition,\n        insurance_provider\n    FROM {{ source(\"source_silver\",\"healthcare\") }}\n)\nSELECT\n    row_number() OVER (ORDER BY md5(patient_name)) AS patient_sk,\n    patient_name,\n    gender,\n    blood_type,\n    medical_condition,\n    insurance_provider\nFROM base;\n\n\n-- doctor_billing_summary.sql\n\n{{ config(materialized='table') }}\n\nWITH billing AS (\n    SELECT\n        patient_sk,\n        hospital,\n        SUM(ROUND(billing_amount, 2)) AS total_billed\n    FROM {{ ref('vw_patient_summary') }}\n    GROUP BY patient_sk, hospital\n),\n\nadmissions AS (\n    SELECT\n        doctor_sk,\n        patient_sk,\n        hospital,\n        SUM(total_admissions) AS total_admissions\n    FROM {{ ref('fact_admissions') }}\n    GROUP BY doctor_sk, patient_sk, hospital\n)\n\nSELECT\n    doc.doctor_sk,\n    doc.doctor,\n    doc.hospital,\n    COUNT(DISTINCT a.patient_sk) AS total_patients,\n    SUM(a.total_admissions) AS total_admissions,\n    ROUND(SUM(b.total_billed), 2) AS total_billed,\n    \n    -- \u2705 Fixed division: use CASE instead of DIVIDE()\n    ROUND(\n        CASE \n            WHEN SUM(a.total_admissions) = 0 THEN 0\n            ELSE SUM(b.total_billed) / SUM(a.total_admissions)\n        END, 2\n    ) AS avg_billed_per_admission\n\nFROM admissions a\nLEFT JOIN billing b\n    ON a.patient_sk = b.patient_sk AND a.hospital = b.hospital\nLEFT JOIN {{ ref('dim_doctor') }} doc\n    ON a.doctor_sk = doc.doctor_sk\nGROUP BY 1,2,3\n\n-- fact_admissions.sql\n\n{{ config(materialized='table') }}\n\nWITH base AS (\n    SELECT\n        doctor,\n        hospital,\n        admission_type,\n        name AS patient_name,\n        gender,\n        blood_type,\n        medical_condition,\n        insurance_provider,\n        date_of_admission,\n        discharge_date,\n        COUNT(*) AS total_admissions,\n        ROUND(AVG(stay_duration_days), 2) AS avg_stay_duration\n    FROM {{ source(\"source_silver\",\"healthcare\") }}\n    GROUP BY doctor, hospital, admission_type, name, gender, blood_type, \n             medical_condition, insurance_provider, date_of_admission, discharge_date\n)\n\nSELECT\n    ROW_NUMBER() OVER (\n        ORDER BY md5(\n            COALESCE(b.doctor,'') || COALESCE(b.hospital,'') || \n            COALESCE(b.admission_type,'') || COALESCE(b.patient_name,'')\n        )\n    ) AS admission_sk,\n\n    -- Foreign keys\n    d.doctor_sk,\n    p.patient_sk,\n    h.hospital_sk,\n    d_admit.date_sk AS admission_date_sk,\n    d_discharge.date_sk AS discharge_date_sk,\n\n    -- Original attributes\n    b.doctor,\n    b.hospital,\n    b.admission_type,\n    b.total_admissions,\n    b.avg_stay_duration,\n    b.date_of_admission,\n    b.discharge_date\n\nFROM base b\nLEFT JOIN {{ ref('dim_doctor') }} d\n    ON b.doctor = d.doctor AND b.hospital = d.hospital\nLEFT JOIN {{ ref('dim_patient') }} p\n    ON b.patient_name = p.patient_name \n    AND b.gender = p.gender \n    AND b.medical_condition = p.medical_condition \n    AND b.insurance_provider = p.insurance_provider\nLEFT JOIN {{ ref('dim_hospital') }} h\n    ON b.hospital = h.hospital\nLEFT JOIN {{ ref('dim_date') }} d_admit\n    ON to_date(b.date_of_admission) = d_admit.full_date\nLEFT JOIN {{ ref('dim_date') }} d_discharge\n    ON to_date(b.discharge_date) = d_discharge.full_date;\n\n\n-- fact_billing_summary.sql\n\n{{ config(materialized='table') }}\n\nWITH base AS (\n    SELECT\n        doctor,\n        hospital,\n        admission_type,\n        name AS patient_name,\n        gender,\n        blood_type,\n        medical_condition,\n        insurance_provider,\n        date_of_admission,\n        discharge_date,\n        ROUND(SUM(billing_amount), 2) AS total_billed,\n        ROUND(AVG(billing_amount), 2) AS avg_bill,\n        COUNT(DISTINCT name) AS total_patients\n    FROM {{ source(\"source_silver\",\"healthcare\") }}\n    GROUP BY doctor, hospital, admission_type, name, gender, blood_type, \n             medical_condition, insurance_provider, date_of_admission, discharge_date\n)\n\nSELECT\n    ROW_NUMBER() OVER (\n        ORDER BY md5(\n            COALESCE(b.doctor,'') || COALESCE(b.hospital,'') || \n            COALESCE(b.patient_name,'') || COALESCE(b.admission_type,'')\n        )\n    ) AS billing_sk,\n\n    -- Foreign keys\n    d.doctor_sk,\n    p.patient_sk,\n    h.hospital_sk,\n    d_bill.date_sk AS billing_date_sk,\n\n    -- Original attributes\n    b.doctor,\n    b.hospital,\n    b.admission_type,\n    b.total_billed,\n    b.avg_bill,\n    b.total_patients,\n    b.date_of_admission AS billing_date\n\nFROM base b\nLEFT JOIN {{ ref('dim_doctor') }} d\n    ON b.doctor = d.doctor AND b.hospital = d.hospital\nLEFT JOIN {{ ref('dim_patient') }} p\n    ON b.patient_name = p.patient_name \n    AND b.gender = p.gender \n    AND b.medical_condition = p.medical_condition \n    AND b.insurance_provider = p.insurance_provider\nLEFT JOIN {{ ref('dim_hospital') }} h\n    ON b.hospital = h.hospital\nLEFT JOIN {{ ref('dim_date') }} d_bill\n    ON to_date(b.date_of_admission) = d_bill.full_date;\n\n\n", "embedding": [-0.047699250280857086, -0.015681477263569832, -0.0003860814031213522, -0.02314838394522667, 0.009024815633893013, -0.014392060227692127, -0.037353213876485825, -0.023582134395837784, -0.019831402227282524, -0.002706483704969287, 0.03393324092030525, -0.007438973989337683, 0.02517855167388916, 0.020872190594673157, 0.005196546204388142, 0.019152652472257614, -0.0184783898293972, 0.006956934463232756, -0.012583735398948193, 0.04789911210536957, 0.024304667487740517, -0.004709659609943628, -0.04496978968381882, -0.024582812562584877, 0.019473209977149963, 0.03357507288455963, 0.008622747845947742, -0.04789853096008301, -0.02504940889775753, -0.19974689185619354, 0.002429833635687828, -0.013505056500434875, 0.019409112632274628, -0.042000144720077515, -0.024190256372094154, -0.047157201915979385, 0.04344406723976135, 0.034890998154878616, -0.03633061796426773, 0.016183992847800255, 0.009268327616155148, 0.005552682559937239, 0.004685151390731335, -0.04985610395669937, -0.006508320104330778, -0.016375040635466576, -0.028471877798438072, 0.02865242026746273, 0.04205266386270523, 0.03339019790291786, 0.020401814952492714, -0.018157383427023888, -0.06019486114382744, 0.07378329336643219, 0.025842679664492607, -0.011442658491432667, 0.04172995686531067, 0.014573052525520325, -0.00448938924819231, -0.020818136632442474, 0.020671064034104347, 0.0224846713244915, -0.18164870142936707, 0.05003362149000168, -0.035696011036634445, -0.0104673458263278, -0.01316823810338974, -0.02907397225499153, 0.02403915300965309, 0.07553503662347794, -0.012955657206475735, -0.013281521387398243, 0.016824552789330482, 0.037243377417325974, 0.027747612446546555, -0.012426473200321198, 0.009806754998862743, 0.006856251507997513, 0.01959814503788948, 0.027930978685617447, -0.02703624777495861, 0.007517050486057997, 0.011754256673157215, -0.02658531628549099, -0.026438409462571144, 0.010858937166631222, 0.029516620561480522, -0.051178086549043655, 0.003526834538206458, -0.0014106896705925465, -0.0005365802207961679, -0.022216543555259705, -0.025366326794028282, -0.00830123107880354, -0.05655737593770027, -0.021413609385490417, -0.0036523679737001657, -0.008778626099228859, 0.004849317017942667, 0.5960363745689392, -0.06061943247914314, 0.03327178955078125, -0.029625410214066505, -0.0075927721336483955, -0.04541826993227005, -0.02270607091486454, -0.02063542976975441, -0.03558240458369255, 0.02387712523341179, -0.008961678482592106, -0.046760693192481995, 0.04614071175456047, 0.051674734801054, -0.09324268996715546, -0.002619109582155943, 0.013664115220308304, 0.043845392763614655, 0.013081441633403301, -0.0055596474558115005, -0.003514134092256427, 0.030620809644460678, 0.02346515841782093, 0.03634115681052208, 0.005483982618898153, 0.0013355726841837168, -0.011481141671538353, 0.029685689136385918, 0.04013358801603317, 0.006562354974448681, -0.013507100753486156, 0.04607756808400154, -0.03620606288313866, -0.07184489071369171, -0.030487854033708572, 0.018113112077116966, -0.017019638791680336, 0.015756817534565926, -0.015202430076897144, -0.003410231089219451, -0.01830151118338108, -0.054488006979227066, -0.06419318169355392, 0.011312263086438179, 0.003228092798963189, -0.05983027070760727, 0.13761551678180695, -0.03296729549765587, -0.01797783561050892, -0.023429131135344505, -0.042732562869787216, -0.012717372737824917, 0.02922155149281025, 0.0021538722794502974, -0.010008463636040688, 0.0026854812167584896, 0.04824312403798103, 0.06400354206562042, -0.010147840715944767, -0.07603288441896439, -0.030062973499298096, -0.02620706334710121, -0.029182398691773415, -0.02693396620452404, 0.07933928817510605, 0.029871361330151558, -0.09751320630311966, -0.033331651240587234, 0.04421752318739891, 0.025754854083061218, -0.036343976855278015, 0.03123062662780285, 0.0017038000514730811, -0.00729810306802392, 0.03383200988173485, 0.06942131370306015, 0.009432252496480942, 0.01928568445146084, 0.01101638376712799, -0.009875482879579067, 0.015995757654309273, 0.009461095556616783, -0.02223813720047474, -0.047467563301324844, 0.019658589735627174, -0.013445831835269928, -0.027696045115590096, -0.004162817262113094, 0.021722402423620224, 0.04523947834968567, -0.012371957302093506, -0.0003845637838821858, 0.01729760505259037, -0.061523355543613434, -0.00942293182015419, -0.020800452679395676, -0.059534166008234024, -0.03463423252105713, 0.02207045815885067, 0.014031095430254936, -0.010934378020465374, 0.042616453021764755, -0.012563921511173248, -0.0013999362709000707, 0.043888647109270096, 0.04581005871295929, -0.004047148395329714, 0.009220042265951633, -0.06073036789894104, 0.03633320331573486, 0.036212239414453506, -0.026229584589600563, 0.01970861479640007, 0.04543376713991165, 0.002231411635875702, -0.04693115875124931, 0.06654108315706253, 0.0001498627389082685, -0.002140419790521264, 0.023595115169882774, 0.02751372568309307, 0.0007749686483293772, 3.92437978007365e-05, -0.0030702536460012197, -0.22895948588848114, 0.01957058161497116, -0.0066109527833759785, -0.020124277099967003, -0.029079696163535118, 0.001221288344822824, -0.020172180607914925, -0.040640320628881454, 0.014344191178679466, 0.030738065019249916, 0.03786632791161537, 0.037992291152477264, -0.03721877560019493, -0.025255301967263222, -0.050187211483716965, 0.01737583987414837, 0.03515993431210518, 0.0031768404878675938, -0.04232564568519592, -0.04562656208872795, 0.005022086203098297, -0.02241997793316841, -0.039299651980400085, -0.06394760310649872, 0.05919894576072693, 0.0003082692564930767, 0.16375456750392914, -0.01884203962981701, 0.029743218794465065, -0.023869747295975685, 0.04389076307415962, -0.012954753823578358, -0.023110464215278625, -0.07845299690961838, 0.0342278890311718, -0.04172070324420929, -0.012224173173308372, 4.4173018977744505e-05, -0.06525568664073944, -0.03147702291607857, -0.0528448149561882, 0.028881171718239784, -0.029557324945926666, -0.04218163341283798, 0.015996091067790985, 0.0033906702883541584, 0.0522097572684288, 0.030101336538791656, -0.03895505890250206, 0.021916260942816734, 0.00460055610165, -0.03655321151018143, 0.038114894181489944, 0.035636402666568756, -0.007872450165450573, -0.009950125589966774, -0.07301541417837143, 0.022857530042529106, -0.015171664766967297, -0.006337914150208235, 0.007291699759662151, -0.00881665013730526, -0.021332910284399986, 0.010434235446155071, -0.032927896827459335, 0.015249907970428467, 0.0314534567296505, -0.014036360196769238, 0.017122138291597366, 0.0015234114835038781, -0.02857651561498642, 0.025855183601379395, -0.06513232737779617, -0.01938830316066742, 0.03630494326353073, -0.0063993604853749275, -0.019019192084670067, 0.023489417508244514, -0.02288280613720417, -0.017054831609129906, 0.018241362646222115, -0.03152437508106232, 0.04044115170836449, 0.047566015273332596, 0.059154268354177475, 0.020699208602309227, 0.04779694601893425, 0.05521373450756073, 0.007519145496189594, -0.022887656465172768, -0.015447398647665977, -0.031705159693956375, -0.025263791903853416, 0.016251763328909874, 0.025408310815691948, -0.0036182496696710587, -0.27479374408721924, 0.06842764467000961, -0.01675671525299549, 0.03705599904060364, 0.014471359550952911, 0.0055198827758431435, -0.026976734399795532, -0.002763161202892661, -0.021928919479250908, -0.047684915363788605, 0.02170993573963642, 0.011109675280749798, 0.029225243255496025, -0.015397237613797188, 0.014866371639072895, 0.024088231846690178, 0.057939570397138596, -0.004129952751100063, 0.026363249868154526, 0.0066408696584403515, 0.017843516543507576, 0.0025606825947761536, 0.14990240335464478, 0.01616661809384823, -0.01204664260149002, 0.03878161311149597, -0.01559349987655878, 0.009904551319777966, 0.010816026479005814, 0.03231280297040939, 0.014749754220247269, -0.01022134255617857, 0.08030623942613602, 0.014727067202329636, 0.04442036896944046, 0.04186438396573067, -0.040107086300849915, 0.06466832756996155, 0.03170248121023178, 0.009430239908397198, -0.016842972487211227, 0.03273981437087059, -0.030954502522945404, 0.05177239328622818, 0.042967788875103, -0.015980971977114677, 0.02035590447485447, -0.04424559697508812, 0.016853714361786842, -0.0076471976935863495, -0.020339421927928925, 0.03290668874979019, -0.010394508019089699, 0.024512145668268204, 0.0008064269204623997, 0.010326816700398922, 0.024320222437381744, -0.017099855467677116, 0.005771367810666561, 0.015620197169482708, -0.023277154192328453, -0.03344130516052246, -0.007487002294510603, 0.000958419288508594, -0.004734308458864689]}, "dbt_ml_models.sql": {"content": "-- patient_readmission_30d.sql\n\n{{ config(\n    materialized='table',\n    schema='ml'\n) }}\n\nWITH ordered AS (\n    SELECT\n        name AS patient_name,\n        gender,\n        age,\n        medical_condition,\n        hospital,\n        insurance_provider,\n        date_of_admission,\n        discharge_date,\n        stay_duration_days,\n        billing_amount,\n\n        ROW_NUMBER() OVER (\n            PARTITION BY name\n            ORDER BY date_of_admission\n        ) AS encounter_id,\n\n        LEAD(date_of_admission) OVER (\n            PARTITION BY name\n            ORDER BY date_of_admission\n        ) AS next_admission\n    FROM {{ source('source_silver', 'healthcare') }}\n    WHERE discharge_date IS NOT NULL\n),\nflagged AS (\n    SELECT\n        *,\n        DATEDIFF(next_admission, discharge_date) AS days_to_next_admit,\n        CASE\n            WHEN next_admission IS NOT NULL\n                 AND next_admission > discharge_date\n                 AND DATEDIFF(next_admission, discharge_date) BETWEEN 0 AND 30 THEN 1\n            ELSE 0\n        END AS readmitted_within_30d\n    FROM ordered\n)\nSELECT\n    patient_name,\n    gender,\n    age,\n    medical_condition,\n    hospital,\n    insurance_provider,\n    stay_duration_days,\n    billing_amount,\n    days_to_next_admit,\n    readmitted_within_30d,\n    CASE \n        WHEN medical_condition IN ('Cancer','Heart Disease','Diabetes','Hypertension')\n             OR stay_duration_days > 15 THEN 'High'\n        ELSE 'Normal'\n    END AS risk_level\nFROM flagged\n\n\n-- stay_duration.sql\n\n{{ config(\n    materialized='table',\n    schema='ml'\n) }}\n\nSELECT\n    name AS patient_name,\n    gender,\n    age,\n    blood_type,\n    medical_condition,\n    hospital,\n    insurance_provider,\n    billing_amount,\n    medication,\n    test_results,\n\n    -- Derive risk level (based on condition and stay)\n    CASE \n        WHEN medical_condition IN ('Cancer', 'Heart Disease', 'Diabetes', 'Hypertension')\n             OR stay_duration_days > 15 THEN 'High'\n        ELSE 'Normal'\n    END AS risk_level,\n\n    stay_duration_days AS target_stay_duration\n\nFROM {{ source('source_silver', 'healthcare') }}\nWHERE stay_duration_days IS NOT NULL\n\n\n", "embedding": [-0.05528735741972923, -0.025860842317342758, -0.022388789802789688, -0.014231353998184204, -0.013135409913957119, -0.041278328746557236, 0.012168941088020802, -0.01380566880106926, -0.009607107378542423, -0.026804493740200996, 0.028445005416870117, -0.018487518653273582, 0.010665323585271835, 0.012490413151681423, -0.02675001136958599, 0.032880596816539764, -0.0018763428088277578, 0.006284778006374836, 0.0017897317884489894, 0.05717180296778679, 0.0002171485684812069, 0.002632003277540207, -0.016330599784851074, -0.027257151901721954, 0.026693370193243027, 0.05655363202095032, 0.014280920848250389, -0.03450252488255501, -0.04588114842772484, -0.17955759167671204, -0.00787771213799715, -0.017393436282873154, -0.028495239093899727, -0.03912583738565445, 0.0010000203037634492, -0.030578719452023506, -0.00980108231306076, 0.04498988762497902, -0.006776137743145227, 0.018775561824440956, -0.0060381111688911915, 0.02035522647202015, -0.011579950340092182, -0.021321317180991173, -0.0034618868958204985, -0.02203429862856865, -0.042671505361795425, -0.02410416305065155, 0.07123328000307083, 0.05654330179095268, -0.021093852818012238, 0.041700076311826706, 0.002941136946901679, 0.0708422139286995, 0.01483906526118517, 0.0062942844815552235, 0.013320930302143097, 0.04402448609471321, -0.0018071314552798867, 0.009106985293328762, 0.018306346610188484, 0.04379479959607124, -0.1795131415128708, 0.029420066624879837, -0.03686428442597389, 0.013296909630298615, -0.015107519924640656, -0.019413696601986885, 0.022509656846523285, 0.02372833527624607, 0.0012329138116911054, -0.023749062791466713, -0.01935882493853569, 0.07905132323503494, 0.04239804297685623, -0.053574223071336746, 0.019687701016664505, -0.022654986009001732, 0.01849900372326374, 0.0014928076416254044, -0.010084670968353748, 0.03350624814629555, 0.0011983574368059635, -0.010045420378446579, -0.02899792604148388, -0.0054910569451749325, 0.03426332771778107, -0.058780375868082047, 0.0013691472122445703, 0.01713549718260765, -0.009006872773170471, -0.021895885467529297, -0.04783705249428749, 0.015023796819150448, -0.06043211743235588, -0.004892393015325069, 0.023183513432741165, -0.009275306016206741, -0.004577741026878357, 0.6052036881446838, -0.01758737489581108, 0.035892270505428314, -0.04571732506155968, -0.012788724154233932, -0.020445873960852623, -0.029445549473166466, -0.008148424327373505, -0.025302477180957794, 0.007555088028311729, -0.03249235823750496, -0.038400836288928986, -0.016248036175966263, 0.07200127094984055, -0.07236029207706451, -0.012199152261018753, 0.044157542288303375, 0.04082655906677246, 0.00275571015663445, 0.0013393942499533296, 0.0025533174630254507, 0.0018224044470116496, 0.023302454501390457, 0.033903710544109344, 0.008914351463317871, -0.007964154705405235, -0.02457401342689991, 0.01985219679772854, 0.03251485899090767, 0.020026786252856255, 0.012422129511833191, 0.05472465604543686, -0.028028668835759163, -0.03332691639661789, -0.003981001675128937, 0.011485815979540348, -0.00222165253944695, -0.006919455248862505, -0.004192012827843428, 0.011670262552797794, -0.031498122960329056, -0.019863352179527283, -0.09486262500286102, 0.008207363076508045, -0.032248180359601974, -0.05853380635380745, 0.13548912107944489, -0.058618929237127304, 0.0239005945622921, -0.05134241655468941, -0.003036722308024764, 0.009586386382579803, 0.05461776629090309, -0.008563056588172913, -0.02537292055785656, -0.027469344437122345, 0.015340709127485752, 0.07203523814678192, 0.011245791800320148, -0.06757986545562744, -0.02508961223065853, 0.021055657416582108, -0.07015625387430191, -0.028642205521464348, 0.07415875792503357, 0.03125636279582977, -0.051430363208055496, -0.03702114522457123, 0.0082929115742445, 0.026888033375144005, -0.01646653190255165, 0.06355694681406021, -0.007665250916033983, 0.008752870373427868, 0.018434597179293633, 0.05297371745109558, 0.016149716451764107, 0.021326428279280663, 0.0057070632465183735, -0.008569112978875637, 0.015845725312829018, 0.01567300781607628, 0.010549257509410381, -0.0457843616604805, 0.009340902790427208, -0.004465978592634201, -0.021040810272097588, -0.025750774890184402, -0.0017471074825152755, 0.07174783945083618, 0.0062003000639379025, -0.0196397565305233, 0.0004821994516532868, -0.04814168065786362, 0.009914414025843143, -0.039389919489622116, -0.0718204453587532, -0.058156613260507584, -0.005035424139350653, 0.0008479001699015498, -0.032703787088394165, 0.05190861225128174, 0.0032327957451343536, -0.03984230011701584, 0.019458409398794174, 0.0025096056051552296, 0.011045368388295174, -0.0032287477515637875, -0.04958272725343704, 0.014788015745580196, 0.020082054659724236, 0.0037712084595113993, 0.02309822104871273, 0.01720854453742504, 0.025255190208554268, -0.011386367492377758, 0.025898437947034836, 0.033728741109371185, 0.016591832041740417, 0.03681013360619545, 0.05154700577259064, 0.014386510476469994, 0.04990977421402931, 0.023021938279271126, -0.22567777335643768, 0.016126640141010284, -0.021171029657125473, -0.038743410259485245, -0.04115968197584152, -0.015916848555207253, 0.00153095624409616, -0.008828974328935146, -0.015518561005592346, 0.03099900856614113, 0.06713949143886566, 0.008930480107665062, -0.023377226665616035, 0.002189158694818616, -0.02667979896068573, -0.00769949983805418, 0.027103301137685776, 0.008316094055771828, -0.034077491611242294, -0.051441386342048645, 0.03632998839020729, -0.00435661431401968, 0.009509135968983173, -0.043870098888874054, 0.04072596877813339, 0.012454874813556671, 0.14243225753307343, -0.0316532664000988, 0.02777477540075779, -0.015567478723824024, 0.03197237476706505, -0.015413936227560043, -0.01826777495443821, -0.07290069013834, 0.0364396870136261, -0.02415207400918007, -0.03935467451810837, 0.011775228194892406, -0.05779297649860382, -0.04745688661932945, -0.0407286174595356, 0.04015018045902252, -0.011434851214289665, -0.03459246829152107, 0.010619801469147205, -0.030960677191615105, 0.009501593187451363, 0.03421235457062721, -0.044367466121912, 0.03386319428682327, -0.0014830854488536716, -0.003753818105906248, 0.018900416791439056, 0.037873536348342896, 0.04454641044139862, -0.01695750094950199, -0.08634540438652039, -0.019644388929009438, -0.04031230881810188, 0.037238430231809616, -0.0012536764843389392, -0.008601395413279533, 0.023527709767222404, -0.014264814555644989, -0.028873790055513382, -0.03825538605451584, 0.006939374376088381, -0.017971940338611603, -0.00499570369720459, -0.01259278692305088, -0.03884196653962135, 0.036243557929992676, -0.02514052391052246, -0.017053497955203056, 0.06327970325946808, 0.03406447172164917, -0.004180420655757189, -0.010063966736197472, 0.016166232526302338, -0.009024150669574738, 0.039668284356594086, -0.02293574810028076, 0.0381101630628109, 0.023695213720202446, 0.03483373671770096, 0.021021345630288124, 0.05170944705605507, 0.03736016899347305, -0.01975608803331852, -0.003936967812478542, -0.05115381255745888, -0.04390342906117439, -0.04583068937063217, 0.028710154816508293, 0.004093345254659653, -0.024037135764956474, -0.29567819833755493, 0.058669865131378174, -0.015569675713777542, 0.028285766020417213, 0.029591213911771774, -0.006706461310386658, -0.01970568858087063, -0.022733936086297035, -0.023530883714556694, -0.008375877514481544, 0.015461154282093048, 0.0372801348567009, 0.02272205986082554, -0.034610092639923096, 0.00796349998563528, 0.02460288256406784, 0.06265170872211456, 0.015160947106778622, 0.0331379771232605, -0.017707601189613342, 0.04576040431857109, 0.020254364237189293, 0.14409895241260529, -0.036007534712553024, 0.0027981989551335573, 0.021957313641905785, 0.026326708495616913, 0.022549182176589966, -0.01291185338050127, 0.03499062731862068, 0.002549445955082774, 0.0010473367292433977, 0.09600800275802612, 0.009083499200642109, 6.663186650257558e-05, 0.03660421818494797, -0.010260033421218395, 0.054830294102430344, 0.018967216834425926, -0.007982419803738594, -0.022162001579999924, 0.01701829396188259, -0.01640043780207634, 0.02445710450410843, 0.055689409375190735, -0.03274285048246384, -0.008700009435415268, -0.06956039369106293, 0.013869260437786579, 0.019356418401002884, -0.02136421576142311, 0.023194149136543274, -0.026410125195980072, -0.003587493672966957, 0.012716907076537609, 0.006406818050891161, 0.019611358642578125, -0.02406070940196514, 0.013643133454024792, -0.01173933781683445, -0.03577050566673279, -0.021786734461784363, 0.009861080907285213, 0.012239618226885796, -0.012902828864753246]}, "dbt_views.sql": {"content": "-- vw_avg_stay_by_hospital.sql\n\n{{ config(materialized='view') }}\n\nSELECT\n    h.hospital_sk,\n    s.hospital,\n    COUNT(*) AS total_patients,\n    ROUND(AVG(s.stay_duration_days), 2) AS avg_stay_days,\n    MIN(s.stay_duration_days) AS min_stay_days,\n    MAX(s.stay_duration_days) AS max_stay_days\nFROM {{ source(\"source_silver\", \"healthcare\") }} s\nLEFT JOIN {{ ref('dim_hospital') }} h\n    ON COALESCE(s.hospital,'') = COALESCE(h.hospital,'')\nGROUP BY h.hospital_sk, s.hospital\nORDER BY avg_stay_days DESC;\n\n-- vw_high_risk_patients.sql\n\n{{ config(materialized='view') }}\n\nWITH ranked AS (\n    SELECT\n        p.patient_sk,\n        h.name AS patient_name,\n        h.age,\n        h.gender,\n        h.medical_condition,\n        h.hospital,\n        h.insurance_provider,\n        ROUND(h.billing_amount, 2) AS billing_amount,\n        h.stay_duration_days,\n        h.date_of_admission,\n        h.discharge_date,\n        CASE \n            WHEN h.medical_condition IN ('Cancer', 'Heart Disease', 'Diabetes', 'Hypertension')\n                 OR h.stay_duration_days > 15\n            THEN 'High'\n            ELSE 'Normal'\n        END AS risk_level,\n        ROW_NUMBER() OVER (\n            PARTITION BY p.patient_sk, h.date_of_admission\n            ORDER BY h.discharge_date DESC\n        ) AS rn\n    FROM {{ source(\"source_silver\", \"healthcare\") }} h\n    LEFT JOIN {{ ref('dim_patient') }} p\n        ON h.name = p.patient_name\n        AND h.gender = p.gender\n        AND h.medical_condition = p.medical_condition\n        AND h.insurance_provider = p.insurance_provider\n)\n\nSELECT\n    r.*,\n    d_admit.date_sk AS admission_date_sk,\n    d_discharge.date_sk AS discharge_date_sk\nFROM ranked r\nLEFT JOIN {{ ref('dim_date') }} d_admit\n    ON to_date(r.date_of_admission) = d_admit.full_date\nLEFT JOIN {{ ref('dim_date') }} d_discharge\n    ON to_date(r.discharge_date) = d_discharge.full_date\nWHERE r.rn = 1;\n\n\n-- vw_patient_summary.sql\n\n{{ config(materialized='view') }}\n\nWITH ranked AS (\n    SELECT\n        p.patient_sk,\n        h.name AS patient_name,\n        h.age,\n        CASE \n            WHEN h.age < 18 THEN 'Under 18'\n            WHEN h.age BETWEEN 18 AND 29 THEN '18\u201329'\n            WHEN h.age BETWEEN 30 AND 44 THEN '30\u201344'\n            WHEN h.age BETWEEN 45 AND 59 THEN '45\u201359'\n            WHEN h.age BETWEEN 60 AND 74 THEN '60\u201374'\n            ELSE '75+'\n        END AS age_group,\n        h.gender,\n        h.medical_condition,\n        h.hospital,\n        h.insurance_provider,\n        h.medication,\n        h.admission_type,\n        h.date_of_admission,\n        h.discharge_date,\n        h.stay_duration_days,\n        ROUND(h.billing_amount, 2) AS billing_amount,\n        h.test_results,\n\n        -- \u2705 Added comma before ROW_NUMBER()\n        CASE \n            WHEN h.medical_condition IN ('Cancer', 'Heart Disease', 'Diabetes', 'Hypertension')\n                OR h.stay_duration_days > 15\n            THEN 'High'\n            ELSE 'Normal'\n        END AS risk_level,\n\n        ROW_NUMBER() OVER (\n            PARTITION BY p.patient_sk, h.date_of_admission\n            ORDER BY h.discharge_date DESC\n        ) AS rn\n    FROM {{ source(\"source_silver\", \"healthcare\") }} h\n    LEFT JOIN {{ ref('dim_patient') }} p\n        ON h.name = p.patient_name\n        AND h.gender = p.gender\n        AND h.medical_condition = p.medical_condition\n        AND h.insurance_provider = p.insurance_provider\n)\n\nSELECT\n    r.*,\n    d_admit.date_sk AS admission_date_sk,\n    d_discharge.date_sk AS discharge_date_sk\nFROM ranked r\nLEFT JOIN {{ ref('dim_date') }} d_admit\n    ON TO_DATE(r.date_of_admission) = d_admit.full_date\nLEFT JOIN {{ ref('dim_date') }} d_discharge\n    ON TO_DATE(r.discharge_date) = d_discharge.full_date\nWHERE r.rn = 1\nORDER BY r.date_of_admission DESC;\n\n\n-- vw_total_billing_by_insurance.sql\n\n{{ config(materialized='view') }}\n\nSELECT\n    row_number() OVER (ORDER BY md5(insurance_provider)) AS insurance_sk,\n    insurance_provider,\n    COUNT(*) AS total_claims,\n    ROUND(SUM(billing_amount), 2) AS total_billing,\n    ROUND(AVG(billing_amount), 2) AS avg_billing,\n    MAX(billing_amount) AS max_billing\nFROM {{ source(\"source_silver\", \"healthcare\") }}\nGROUP BY insurance_provider\nORDER BY total_billing DESC;\n", "embedding": [-0.046702660620212555, -0.025362011045217514, -0.04513636603951454, 0.0028165853582322598, 0.012369558215141296, 0.002851625671610236, -0.00770870316773653, -0.001285211299546063, 0.010019281879067421, 0.005617594346404076, 0.009530078619718552, -0.025046391412615776, 0.025496259331703186, 0.005294753238558769, -0.02208026684820652, -0.00681183161213994, -0.013023274950683117, -0.020776038989424706, -0.010525116696953773, 0.052638184279203415, -0.0007071297732181847, -0.017397157847881317, -0.03193330019712448, -0.041145794093608856, 0.024700164794921875, 0.029574893414974213, 0.008846761658787727, -0.03934872895479202, -0.01804346777498722, -0.1978529989719391, 0.0016738511621952057, -0.029155919328331947, 0.012080159038305283, -0.022345134988427162, -0.004348368383944035, -0.03907627984881401, 0.005554744508117437, 0.05071784183382988, -0.02479829266667366, 0.017155036330223083, -0.022869421169161797, 0.012658908031880856, 0.003250693902373314, -0.013942897319793701, 0.008760647848248482, -0.04493100196123123, -0.015883497893810272, -0.01951451040804386, 0.04778512567281723, 0.05146881192922592, 0.018667906522750854, 0.012065017595887184, -0.03232571482658386, 0.05779510363936424, 0.048356447368860245, -0.00749456649646163, 0.0430755615234375, 0.022970300167798996, 0.010344944894313812, 0.011773818172514439, 0.035537239164114, 0.0200496893376112, -0.19090431928634644, 0.017353883013129234, -0.029561087489128113, -0.003976630046963692, -0.013790714554488659, -0.03810134530067444, 0.001087793381884694, 0.03247194364666939, -0.02229291759431362, -0.016724828630685806, -0.005690320394933224, 0.056495342403650284, 0.029226675629615784, -0.03284664824604988, 0.022135324776172638, -0.013086744584143162, 0.010122816078364849, 0.01605984754860401, -0.02232220396399498, 0.008994612842798233, 0.014739749021828175, -0.028021933510899544, 0.0009293713956139982, 0.011971490457654, 0.030778415501117706, -0.036611028015613556, 0.019680717960000038, -0.003770429641008377, 0.00781648512929678, -0.02609887905418873, -0.03060787357389927, -0.004522744100540876, -0.05179015174508095, -0.0069802808575332165, 0.029219841584563255, -0.004319345112890005, -0.015590738505125046, 0.6161775588989258, -0.039456188678741455, 0.03982159122824669, -0.039123278111219406, -0.02058873325586319, -0.01624596118927002, -0.034083202481269836, -0.023020142689347267, -0.022204089909791946, 0.005948216654360294, -0.012780938297510147, -0.01849965751171112, 0.0018088839715346694, 0.05450271815061569, -0.06433165818452835, -0.026979178190231323, 0.0276633407920599, 0.059998851269483566, 0.012718492187559605, 0.008775223977863789, -0.005486702546477318, -0.007251222152262926, 0.01880747079849243, 0.00931299664080143, 0.005768292583525181, 0.009526179172098637, -0.039160747081041336, 0.035468246787786484, 0.048032112419605255, 0.024347452446818352, 0.005865456536412239, 0.05782619118690491, -0.023388659581542015, -0.0330878347158432, -0.03865205869078636, -0.012464356608688831, -0.02293446846306324, 0.04918485879898071, 0.03317670151591301, 0.01585354097187519, -0.02170570380985737, -0.014266119338572025, -0.11256445944309235, 0.014683307148516178, -0.03808852657675743, -0.04687174782156944, 0.13896869122982025, -0.042948316782712936, -0.005929980892688036, -0.038812387734651566, -0.024610400199890137, 0.003430854994803667, 0.03288017213344574, -0.0023933774791657925, -0.03673996776342392, -0.02840336784720421, 0.013348938897252083, 0.04369533434510231, 0.004504922311753035, -0.06504501402378082, -0.03692490607500076, -0.018214451149106026, -0.05921604111790657, -0.018110906705260277, 0.09131589531898499, 0.013168567791581154, -0.07201739400625229, -0.008297957479953766, 0.004416174720972776, 0.02140342816710472, -0.00985589250922203, 0.03179899603128433, 0.00878575537353754, 0.006648228969424963, 0.0115644047036767, 0.06330006569623947, 0.02021983079612255, 0.001971265533939004, 0.02206357568502426, -0.0056926594115793705, 0.010878580622375011, -0.0052387407049536705, -0.0024944317992776632, -0.06861565262079239, 0.022102905437350273, 0.028885699808597565, -0.026581713929772377, -0.021775878965854645, -0.007899311371147633, 0.04658389464020729, 0.009838405065238476, -0.039170246571302414, 0.006192101631313562, -0.048467159271240234, -0.013819180428981781, -0.032564256340265274, -0.0487184152007103, -0.05311470478773117, -0.020332882180809975, 0.013242893852293491, -0.0014186414191499352, 0.05671568214893341, 0.016922134906053543, -0.010351238772273064, 0.0089593306183815, 0.010853494517505169, -0.0053290026262402534, -0.025578085333108902, -0.04622576758265495, 0.021428553387522697, 0.037218574434518814, -0.02050265669822693, 0.015058843418955803, 0.04498262703418732, 0.01892525516450405, -0.022396638989448547, 0.03327330946922302, 0.012316892854869366, 0.040574487298727036, 0.04651399329304695, 0.04920006915926933, -0.009695547632873058, 0.013747918419539928, 0.02316434495151043, -0.21507839858531952, -0.0029729800298810005, -0.027485279366374016, -0.034253086894750595, -0.0490335077047348, -0.012416242621839046, 0.007440674118697643, -0.035888466984033585, -0.018839027732610703, 0.037414051592350006, 0.07901525497436523, 0.02116113156080246, -0.026415690779685974, -0.017396891489624977, 0.007018388248980045, 0.010056638158857822, 0.027709828689694405, 0.025175616145133972, -0.05386972427368164, -0.03960258513689041, 0.006416072137653828, 0.0051389820873737335, -0.0019005110953003168, -0.029824938625097275, 0.05049731582403183, 0.0004582781111821532, 0.17007805407047272, -0.04371805489063263, 0.009401753544807434, -0.014996885322034359, 0.06269227713346481, 0.0002455655194353312, -0.0011770547134801745, -0.05551053583621979, 0.034821201115846634, -0.01826256327331066, -0.02767517976462841, 0.011991930194199085, -0.048865001648664474, -0.02680199034512043, -0.03489472717046738, 0.024838224053382874, -0.03317079320549965, -0.032043520361185074, -0.017545120790600777, -0.041113317012786865, 0.015808697789907455, 0.014275163412094116, -0.031152982264757156, 0.02791997231543064, -0.01114040520042181, -0.016719438135623932, 0.02383936569094658, 0.045810360461473465, 0.020255815237760544, -0.011431215330958366, -0.0449591688811779, -0.00587098952382803, -0.0573677234351635, 0.02843768708407879, 0.0038147438317537308, -0.020456794649362564, 0.01867152377963066, -0.005648658145219088, -0.007834702730178833, -0.018780352547764778, 0.02520807273685932, -0.004184783436357975, 0.007011811248958111, -0.010377773083746433, -0.052587270736694336, 0.017520148307085037, -0.03986111655831337, 0.01496043149381876, 0.0426776260137558, 0.03177374228835106, -0.027012502774596214, 0.005104058887809515, 0.01095640379935503, -0.011408335529267788, 0.014577272348105907, -0.05570897087454796, 0.046581778675317764, 0.046664249151945114, 0.02240384742617607, 0.027392437681555748, 0.055383726954460144, 0.022003168240189552, 0.005885492544621229, 0.01337422989308834, -0.04987940192222595, -0.01213773526251316, -0.007637399714440107, 0.004299563821405172, 0.025362318381667137, -0.018284127116203308, -0.29230931401252747, 0.03410028666257858, -0.034903671592473984, 0.03262992203235626, -0.0035169366747140884, -0.010442262515425682, -0.028117919340729713, -0.02168797329068184, -0.010831081308424473, -0.021604597568511963, 0.014304304495453835, 0.034533850848674774, 0.029180094599723816, -0.059831686317920685, 0.037748392671346664, 0.011961031705141068, 0.04883429408073425, -0.0007927350234240294, 0.0576045997440815, 0.019427265971899033, 0.024146607145667076, 0.016697842627763748, 0.143454447388649, -0.025202350690960884, 0.008787478320300579, 0.02477305568754673, -0.0011438705259934068, 0.013762113638222218, -0.020875249058008194, 0.04430341720581055, -0.021663451567292213, -0.0060767182148993015, 0.12107758969068527, 0.011985788121819496, 0.021953988820314407, 0.027373598888516426, -0.021959858015179634, 0.053364355117082596, 0.02142120525240898, 0.005155070219188929, -1.8752211872197222e-06, 0.017599785700440407, -0.00026325747603550553, 0.039380479604005814, 0.06253309547901154, -0.03457248583436012, 0.025392791256308556, -0.035148460417985916, 0.032697923481464386, -0.0003120690234936774, -0.015379452146589756, 0.021250614896416664, -0.024373071268200874, 0.003712030593305826, 0.007982028648257256, 0.0014711837284266949, 0.004711904563009739, -0.026051823049783707, 0.008766505867242813, -0.02495047263801098, -0.029860390350222588, -0.033478084951639175, 0.004579710774123669, 0.023296963423490524, -0.004346372559666634]}, "etl_summary_notes.sql": {"content": "-- silver_table_validations.sql\n\nUSE patient_risk_prediction.silver;\n\nshow tables;\n\nSELECT *\nFROM patient_risk_prediction.silver.healthcare\nLIMIT 50;\n\n\nselect distinct(medical_condition) from patient_risk_prediction.silver.healthcare;\n\nSELECT \n    hospital,\n    COUNT(*) AS hospital_record_count\nFROM patient_risk_prediction.silver.healthcare\nGROUP BY hospital\nORDER BY hospital\nLIMIT 30;\n\nSELECT\n  name,\n  COUNT(*) AS records,\n  COUNT(DISTINCT date_of_admission) AS distinct_dates\nFROM patient_risk_prediction.silver.healthcare\nGROUP BY name\nHAVING COUNT(*) > 1\nLIMIT 10;\n\n\n-- gold_objects_validation.sql  \n\nUSE patient_risk_prediction.gold;\n\nSHOW TABLES;\n\nselect * from patient_risk_prediction.gold.dim_doctor;\n\nselect * from patient_risk_prediction.gold.dim_patient\nlimit 10;\n\n\nDESCRIBE patient_risk_prediction.gold.dim_patient;\n\nselect count(*) from patient_risk_prediction.gold.dim_doctor; --50000\n\nselect * from patient_risk_prediction.gold.dim_doctor\nlimit 10;\n\nselect doctor_sk,count(*) from patient_risk_prediction.gold.dim_doctor\ngroup by doctor_sk\nhaving count(*) > 1\nORDER BY doctor_sk ASC\nlimit 10;     --None\n\nselect count(*) from patient_risk_prediction.gold.dim_patient; --49952\n\nselect * from patient_risk_prediction.gold.dim_patient\nlimit 10;\n\nselect patient_sk,count(*) from patient_risk_prediction.gold.dim_patient\ngroup by patient_sk\nhaving count(*) > 1\nORDER BY patient_sk ASC\nlimit 10;   --None\n\nselect count(*) from patient_risk_prediction.gold.fact_admissions;  --50539\n\nselect * from patient_risk_prediction.gold.fact_admissions\nlimit 10;\n\nselect patient_sk,count(*) from patient_risk_prediction.gold.fact_admissions\ngroup by patient_sk\nhaving count(*) > 1\nORDER BY patient_sk ASC\nlimit 10;   --have\n\nselect * from patient_risk_prediction.gold.vw_patient_summary\nwhere patient_sk = 7;\n\n\nselect count(*) from patient_risk_prediction.gold.fact_billing_summary;  --45780\n\nselect * from patient_risk_prediction.gold.fact_billing_summary\nlimit 10;\n\nselect billing_sk,count(*) from patient_risk_prediction.gold.fact_billing_summary\ngroup by billing_sk\nhaving count(*) > 1\nORDER BY billing_sk ASC\nlimit 10;   --None\n\nselect count(*) from patient_risk_prediction.gold.vw_avg_stay_by_hospital;  --39876\n\nselect * from patient_risk_prediction.gold.vw_avg_stay_by_hospital\nlimit 10;\n\nselect hospital_sk,count(*) from patient_risk_prediction.gold.vw_avg_stay_by_hospital\ngroup by hospital_sk\nhaving count(*) > 1\nORDER BY hospital_sk ASC\nlimit 10;  --None\n\nselect count(*) from patient_risk_prediction.gold.vw_high_risk_patients;   --56097\n\nselect patient_sk,count(*) from patient_risk_prediction.gold.vw_high_risk_patients\ngroup by patient_sk\nhaving count(*) > 1\nORDER BY patient_sk ASC\nlimit 10;  --have\n\nselect * from patient_risk_prediction.gold.vw_high_risk_patients\nwhere patient_sk = 7;\n\n\nselect * from patient_risk_prediction.gold.vw_high_risk_patients\nlimit 10;\n\nselect count(*) from patient_risk_prediction.gold.vw_patient_summary;   --56097\n\nselect patient_sk,count(*) from patient_risk_prediction.gold.vw_patient_summary\ngroup by patient_sk\nhaving count(*) > 1\nORDER BY patient_sk ASC\nlimit 10;   --Have\n\nselect * from patient_risk_prediction.gold.vw_patient_summary\nlimit 10;\n--where patient_sk = 7;\n\nselect count(*) from patient_risk_prediction.gold.vw_total_billing_by_insurance; --5\n\nselect * from patient_risk_prediction.gold.vw_total_billing_by_insurance\nlimit 10;\n\nselect insurance_sk,count(*) from patient_risk_prediction.gold.vw_total_billing_by_insurance\ngroup by insurance_sk\nhaving count(*) > 1\nORDER BY insurance_sk ASC\nlimit 10;   --None\n\nSELECT \n    hospital,\n    COUNT(*) AS hospital_record_count\nFROM patient_risk_prediction.gold.dim_hospital\nGROUP BY hospital\nORDER BY hospital\nLIMIT 0;\n \nselect count(*) from patient_risk_prediction.gold.dim_doctor;\n\nSELECT COUNT(DISTINCT parent_hospital) AS total_distinct_hospitals\nFROM patient_risk_prediction.gold.dim_hospital;\n\n\nSELECT COUNT(DISTINCT hospital) AS total_distinct_hospitals\nFROM patient_risk_prediction.silver.healthcare;\n\nselect * from patient_risk_prediction.gold.doctor_billing_summary;\n\nselect \ndoctor,\ntotal_patients,\ncount(*)\nfrom patient_risk_prediction.gold.doctor_billing_summary\ngroup by 1,2\nlimit 50;\n\nSELECT \n  doctor,\n  SUM(total_patients) AS total_patients_handled\nFROM patient_risk_prediction.gold.doctor_billing_summary\nGROUP BY doctor\nORDER BY total_patients_handled DESC\nlimit 50;\n\nselect * from patient_risk_prediction.gold.dim_date\nlimit 10;\n\n\n-- Final_Queries.sql\n\n--\ud83e\udde9 1\ufe0f\u20e3 Age Group vs Disease Type\n\n--Goal: Find number of patients per disease type and age group.\n--(You can later visualize this in Power BI as a clustered bar or heat map.)\n\nSELECT \n    p.age_group,\n    p.medical_condition AS disease_type,\n    COUNT(*) AS total_patients,\n    SUM(CASE WHEN h.risk_level = 'High' THEN 1 ELSE 0 END) AS high_risk_patients,\n    ROUND(100.0 * SUM(CASE WHEN h.risk_level = 'High' THEN 1 ELSE 0 END) / COUNT(*), 2) AS high_risk_percent\nFROM patient_risk_prediction.gold.vw_patient_summary AS p\nLEFT JOIN patient_risk_prediction.gold.vw_high_risk_patients AS h \n    ON p.patient_sk = h.patient_sk\nGROUP BY \n    p.age_group,\n    p.medical_condition\nORDER BY \n    p.age_group, total_patients DESC;\n\n\n\n--\ud83d\udc8a 2. Treatment Effectiveness (Based on Medication & Risk Level)\n--You don\u2019t have a treatment type, but you do have medication and risk_level.\n--We can use those to measure effectiveness by assuming \u201cNormal\u201d test results = positive outcome.\nuse patient_risk_prediction.gold;\n\nSELECT\n    medical_condition,\n    medication,\n    COUNT(*) AS total_patients,\n    SUM(CASE WHEN test_results = 'Normal' THEN 1 ELSE 0 END) AS recovered_count,\n    ROUND(100.0 * SUM(CASE WHEN test_results = 'Normal' THEN 1 ELSE 0 END) / COUNT(*), 2) AS effectiveness_rate,\n    ROUND(AVG(stay_duration_days), 1) AS avg_stay_days,\n    ROUND(AVG(billing_amount), 2) AS avg_cost\nFROM patient_risk_prediction.gold.vw_patient_summary\nGROUP BY\n    medication,\n    medical_condition\nORDER BY\n    effectiveness_rate DESC;\n\n\n--\ud83d\udd01 3. Readmission Analysis (Patients readmitted multiple times)\n--You can detect readmissions by counting how often each patient appears.\n\nSELECT\n    patient_name,\n    medical_condition,\n    COUNT(*) AS total_admissions,\n    MIN(date_of_admission) AS first_admission,\n    MAX(discharge_date) AS last_discharge,\n    DATEDIFF(MAX(discharge_date), MIN(date_of_admission)) AS total_duration_span,\n    ROUND(AVG(stay_duration_days), 1) AS avg_stay_per_admission,\n    ROUND(AVG(billing_amount), 2) AS avg_billing_per_stay\nFROM patient_risk_prediction.gold.vw_patient_summary\nGROUP BY\n    patient_name,\n    medical_condition\nHAVING\n    COUNT(*) > 1\nORDER BY\n    total_admissions DESC;\n", "embedding": [-0.036224786192178726, -0.022290365770459175, -0.021350249648094177, -0.01350326742976904, -0.0067062717862427235, 0.01567482016980648, 0.017757222056388855, 0.012193545699119568, 0.028184479102492332, -0.01370213832706213, 0.03769342601299286, 0.0071184756234288216, 0.005470434203743935, 0.019817044958472252, -0.02426537312567234, -0.00772826699540019, 0.0010994516778737307, -0.011239741928875446, -0.04566574841737747, 0.06561654061079025, 0.010057487525045872, -0.001810495974496007, -0.009209915064275265, -0.03848734870553017, 0.041733842343091965, 0.01771768368780613, 0.010025227442383766, -0.036792222410440445, -0.041923683136701584, -0.2106652557849884, -0.022916901856660843, -0.006274533923715353, 0.027504118159413338, -0.020131368190050125, -0.02690010331571102, -0.06497317552566528, 0.010115786455571651, 0.025643495842814445, -0.03376247361302376, 0.021118516102433205, -0.021896256133913994, -0.0018398220418021083, 0.009855670854449272, 0.012502708472311497, 0.019245686009526253, -0.014644025824964046, -0.031693607568740845, -0.02877797558903694, 0.03015526384115219, 0.039142098277807236, 0.02143426239490509, -0.008458370342850685, -0.01107130479067564, 0.07820703834295273, 0.02600460685789585, -0.026834581047296524, 0.021461931988596916, 0.034144915640354156, 8.316685125464574e-05, 0.023446599021553993, 0.02489599771797657, 0.028748882934451103, -0.197242870926857, 0.016903651878237724, -0.004083559382706881, 0.0306816715747118, -0.028364907950162888, -0.031808000057935715, -0.008778301998972893, 0.03565090522170067, 0.03713705763220787, 0.0020296007860451937, 0.002595640253275633, 0.06539511680603027, -0.00667043449357152, -0.003015008755028248, 0.013106117025017738, -0.006783940829336643, 0.02294556237757206, 0.026345962658524513, -0.016875866800546646, 0.03548495098948479, -0.013038105331361294, -0.03976010903716087, -0.010494548827409744, 5.535605305340141e-05, -0.000563463952858001, -0.05168386921286583, 0.020121511071920395, -0.024584392085671425, 0.010367300361394882, -0.013256661593914032, -0.02873915806412697, -0.0030450921040028334, -0.06302692741155624, -0.02261236310005188, 0.002186276949942112, -0.033744290471076965, -0.014830159954726696, 0.5806987881660461, -0.012964677065610886, 0.024514829739928246, -0.041453514248132706, -0.013003242202103138, -0.028029080480337143, -0.031756628304719925, -0.003972580190747976, -0.04516301676630974, 0.020708749070763588, -0.02922649495303631, -0.014052524231374264, -0.020082589238882065, 0.06115927919745445, -0.06027959659695625, -0.01705939508974552, 0.05019404739141464, 0.03068787232041359, 0.009773853234946728, 0.02120014652609825, -0.016664454713463783, -0.005722545087337494, -0.0034681037068367004, 0.03494204580783844, 0.00037656043423339725, 0.010071187280118465, -0.013983003795146942, 0.03843679279088974, 0.07401283085346222, 0.020175641402602196, 0.0208160150796175, 0.056272611021995544, -0.033013053238391876, -0.06594820320606232, -0.01506007369607687, 0.015412422828376293, -0.020714566111564636, 0.035812027752399445, 0.0006998024182394147, 0.031127559021115303, -7.656742673134431e-05, -0.009093377739191055, -0.09531974047422409, 0.014867279678583145, -0.04227878525853157, -0.06432425230741501, 0.12523752450942993, -0.03912002220749855, 0.005820890888571739, -0.04851638153195381, -0.053408991545438766, 0.0002629434166010469, 0.06329590827226639, -0.0013441825285553932, 0.010379200801253319, -0.02487715147435665, 0.028700416907668114, 0.04527466744184494, 0.0019113273592665792, -0.052284106612205505, -0.026207227259874344, -0.009184431284666061, -0.028355294838547707, -0.024441976100206375, 0.08529768884181976, 0.01891927607357502, -0.06642662733793259, -0.033377036452293396, 0.02710232511162758, 0.03081480972468853, -0.026903485879302025, 0.04623183235526085, 0.0027671062853187323, -0.010554064996540546, 0.01738520711660385, 0.03235507383942604, 0.015789764001965523, 0.010441367514431477, -0.01995588280260563, -0.021428747102618217, 0.004346885718405247, 0.00528122391551733, -0.008209426887333393, -0.0630321204662323, 0.04129728302359581, -0.007081561256200075, -0.003457967657595873, -0.016305195167660713, 0.00419909693300724, 0.051495201885700226, 0.01595151610672474, -0.0561538003385067, 0.03254171833395958, -0.03743727132678032, 0.01416082214564085, -0.05616827309131622, -0.023007472977042198, -0.04096881300210953, -0.01607922837138176, -0.013959597796201706, -0.024192918092012405, 0.04882916435599327, 0.00413189921528101, -0.005667645484209061, 0.04909544438123703, 0.02965380623936653, 0.014695104211568832, -1.557229188620113e-05, -0.028609242290258408, 0.01751633733510971, 0.03187962993979454, -0.03384783864021301, 0.020661158487200737, 0.03484645113348961, 0.03349883481860161, -0.0494442917406559, 0.03222859278321266, 0.008833900094032288, 0.030701253563165665, 0.021557491272687912, 0.03638510778546333, 0.035157326608896255, 0.015068655833601952, -0.043293967843055725, -0.23609672486782074, 0.007733885198831558, -4.0756243834039196e-05, -0.011702673509716988, -0.03121350146830082, -0.018629660829901695, 0.017020879313349724, -0.046845898032188416, -0.024237900972366333, 0.03533310070633888, 0.06280077993869781, 0.026769421994686127, -0.0550939105451107, -0.025914834812283516, -0.007371838670223951, 0.02581499144434929, 0.008006468415260315, -0.02539440430700779, -0.04321184381842613, 0.012015653774142265, 0.00047825579531490803, 0.012842560186982155, 0.03487017750740051, -0.03705007955431938, 0.06132814288139343, 0.010989264585077763, 0.15916861593723297, -0.04101939871907234, -0.011928709223866463, -0.018096379935741425, 0.01827405020594597, -0.004256678279489279, -0.016332896426320076, -0.04696476459503174, 0.054731305688619614, -0.015892911702394485, -0.021066851913928986, -0.007707781158387661, -0.04889119416475296, -0.01666128635406494, -0.04302874580025673, 0.02583361603319645, -0.027008607983589172, -0.04239434376358986, -0.024750595912337303, 0.0031940368935465813, 0.015174747444689274, 0.03803616762161255, -0.019850026816129684, 0.05424584448337555, 0.01672573946416378, -0.010722983628511429, 0.03976600617170334, 0.04688752442598343, 0.016566909849643707, -0.014888963662087917, -0.0709259957075119, -0.010718114674091339, -0.04224906861782074, 0.03248989209532738, -0.0004272216756362468, -0.04617371782660484, 0.02250971645116806, -0.00032674241811037064, 0.0013151130406185985, -0.045625604689121246, 0.004984473809599876, -0.0009055217378772795, 0.01770305074751377, -0.020571811124682426, -0.04869940131902695, 0.02888198383152485, -0.02551090531051159, -0.02440343238413334, 0.04649202525615692, 0.03757467120885849, -0.016134347766637802, -0.058877840638160706, -0.010334678925573826, 0.005708595737814903, 0.023041021078824997, -0.01609714888036251, 0.036294013261795044, 0.07570815831422806, 0.03804508224129677, 0.02404039353132248, 0.035959988832473755, 0.023982912302017212, 0.03965577483177185, -0.04028885439038277, -0.030693423002958298, -0.011972435750067234, -0.03835466131567955, 0.032540179789066315, 0.03363095223903656, -0.02401760406792164, -0.29181888699531555, 0.04486939683556557, -0.033660639077425, 0.05891644209623337, 0.02020210400223732, -0.02152116782963276, -0.01013531256467104, -0.03828408569097519, -0.02825980633497238, 0.014686285518109798, 0.03324732184410095, 0.02623477205634117, 0.07134699821472168, -0.02589578367769718, 0.008776981383562088, 0.003283502534031868, 0.07204565405845642, -0.058730483055114746, 0.027600303292274475, 0.026907583698630333, 0.04378899931907654, 0.02169034816324711, 0.15771520137786865, 0.001963302493095398, 0.008798230439424515, 0.017709283158183098, -3.881323493715172e-07, -0.00026424016687087715, -0.020987195894122124, 0.020821936428546906, 0.02207968384027481, -0.02823718450963497, 0.07704201340675354, -0.0024061689618974924, 0.03879264369606972, 0.04416642710566521, -0.03707799315452576, 0.00033668894320726395, 0.002727468265220523, -0.011145716533064842, 0.0019351980881765485, 0.00033379928208887577, -0.03578004613518715, 0.0077208555303514, 0.05252038687467575, -0.045672882348299026, 0.02223237417638302, -0.05997876822948456, 0.00900095421820879, 0.0070576597936451435, -0.026186268776655197, 0.020261405035853386, -0.020650068297982216, -0.029759524390101433, 0.02932308427989483, 0.01261267438530922, 0.029933558776974678, -0.006609560921788216, 0.0015342491678893566, -0.057965945452451706, -0.020470524206757545, -0.024513212963938713, -0.018322641029953957, 0.03294188901782036, -0.016623947769403458]}, "ml_models_summary.txt": {"content": "# ML Models Summary\n\nTwo predictive models were developed:\n\n1. **Readmission Classification Model**\n   - Input: patient demographics, diagnosis, risk level\n   - Target: readmitted_within_30d (0 or 1)\n   - Algorithm: Logistic Regression\n   - Accuracy: ~0.87\n   - Used for: Predicting likelihood of patient readmission\n   -- print(\"\\n================ MODEL PERFORMANCE ================\")\n   -- print(f\"Accuracy        : {accuracy:.4f}\")\n   -- print(f\"ROC-AUC Score   : {roc_auc:.4f}\")\n   -- print(\"\\nClassification Report:\\n\", classification_report(y_test, y_pred))\n   -- print(\"Confusion Matrix:\\n\", confusion_matrix(y_test, y_pred))\n   \n   \n\t================ MODEL PERFORMANCE ================\n\tAccuracy        : 0.9899\n\tROC-AUC Score   : 0.5000\n\n\tClassification Report:\n\t\t\t\t   precision    recall  f1-score   support\n\n\t\t\t   0       0.99      1.00      0.99     10988\n\t\t\t   1       0.00      0.00      0.00       112\n\n\t\taccuracy                           0.99     11100\n\t   macro avg       0.49      0.50      0.50     11100\n\tweighted avg       0.98      0.99      0.98     11100\n\n\tConfusion Matrix:\n\t [[10988     0]\n\t [  112     0]]\n\n\n2. **Stay Duration Regression Model**\n   - Input: patient demographics, treatment, billing data\n   - Target: stay_duration_days\n   - Algorithm: Linear Regression\n   - R\u00b2: 0.76, RMSE: 2.8 days\n   - Used for: Predicting expected hospital stay length\n   import numpy as np\n\tprint(\"\\n================ MODEL PERFORMANCE ================\")\n\tprint(\"Sample Predictions:\", np.round(preds[:10], 2))  # show first 10 predicted values\n\tprint(f\"MAE  : {mae:.3f}\")\n\tprint(f\"MSE  : {mse:.3f}\")\n\tprint(f\"RMSE : {rmse:.3f}\")\n\tprint(f\"R\u00b2   : {r2:.5f}\")\n\t\n\t================ MODEL PERFORMANCE ================\n\tSample Predictions: [15.61 15.34 15.46 15.41 15.43 15.61 15.46 15.44 15.8  15.72]\n\tMAE  : 7.480\n\tMSE  : 74.464\n\tRMSE : 8.629\n\tR\u00b2   : -0.00015\n\nThese models use data from `patient_risk_prediction.ml` schema, trained on Delta tables derived from `silver.healthcare`.\n", "embedding": [-0.03274361044168472, -0.015646280720829964, -0.006908451206982136, 0.0009702531388029456, 0.018024912104010582, -0.0059556616470217705, -0.0172480009496212, 0.040124353021383286, 0.009298780001699924, -0.008832302875816822, 0.005711308214813471, -0.03490179404616356, -0.018131617456674576, 0.017741432413458824, -0.009448917582631111, -0.017002997919917107, 0.010379674844443798, -0.022922104224562645, 0.001311599393375218, 0.05710966885089874, -0.009679487906396389, 0.02784089557826519, -0.035584334284067154, 0.0008481609984301031, 0.03147110342979431, 0.029100758954882622, 0.01293523795902729, -0.03225316107273102, -0.016621360555291176, -0.2195674180984497, -0.0198206827044487, -0.017837757244706154, 0.030077042058110237, -0.008930380456149578, -0.00829269364476204, -0.010344216600060463, 0.02968992292881012, 0.020824430510401726, -0.000983830657787621, 0.01038557942956686, 0.004586857743561268, 0.02780362218618393, 0.007248453795909882, -0.0022457484155893326, 0.05389626324176788, -0.03986746072769165, -0.02229020558297634, -0.01739099808037281, 0.014166047796607018, 0.014240894466638565, 0.013277832418680191, -0.01359296403825283, -0.031650979071855545, 0.0522603876888752, 0.05184623599052429, 0.0020089582540094852, -0.0027046368923038244, 0.027148479595780373, 0.015553767792880535, -0.007648032158613205, -0.00018418850959278643, 0.05543817952275276, -0.18662229180335999, 0.009566332213580608, -0.0022353949025273323, 0.03082178719341755, -0.032770007848739624, -0.07679440826177597, 0.033784862607717514, 0.03845612704753876, -0.02504364214837551, -0.01676139235496521, -0.012809562496840954, 0.055209480226039886, -0.0016369906952604651, -0.007091979030519724, 0.04377182945609093, 0.01419079676270485, 0.031206190586090088, 0.006128024309873581, 0.008919361047446728, -0.014259478077292442, -0.014089147560298443, -0.048046380281448364, -0.019169850274920464, -0.014885318465530872, -0.0005063926219008863, -0.027106311172246933, 0.006205346900969744, -0.008735686540603638, -0.01726341061294079, -0.016315151005983353, -0.015051125548779964, 0.014118872582912445, -0.07352007925510406, -0.01773139461874962, 0.01922793686389923, -0.006355937570333481, -0.04795685037970543, 0.6250171065330505, -0.015576519072055817, 0.00017345308151561767, 0.010947718285024166, -0.03317270427942276, -0.00438550254330039, -0.025346050038933754, -0.009442651644349098, -0.01996167190372944, -0.0002605062909424305, -0.02192947082221508, 0.00987133476883173, 0.006301351357251406, 0.07343529909849167, -0.0517888218164444, -0.02062101475894451, 0.043661411851644516, 0.04448769986629486, 0.03965511918067932, 0.05170081928372383, -0.004295621998608112, -0.021124055609107018, 0.006906921975314617, 0.026904283091425896, -0.0219790730625391, 0.0027898179832845926, -0.04224571958184242, 0.05981772392988205, 0.039922118186950684, 0.007947954349219799, -0.0025214815977960825, 0.04439274221658707, -0.0023682131431996822, -0.050046656280756, 0.0028545288369059563, -0.004168091341853142, -0.011003603227436543, 0.051263414323329926, -0.014744728803634644, 0.0041176266968250275, 0.0019602554384618998, -0.0034812139347195625, -0.0559130534529686, -0.01722472533583641, -0.06788914650678635, -0.07708394527435303, 0.1260477751493454, -0.029624009504914284, -0.0037885589990764856, -0.021767474710941315, -0.0010580351809039712, 0.025576842948794365, 0.08872419595718384, -0.0019733484368771315, -0.007057443261146545, 0.001655659289099276, 0.01906544342637062, 0.04238824546337128, 0.004261462017893791, -0.05748119205236435, 0.007895033806562424, 0.014380225911736488, -0.06518921256065369, -0.05606304854154587, 0.05238023400306702, 0.020590005442500114, -0.06724714487791061, -0.023987049236893654, -0.004455124493688345, 0.00962888915091753, -0.03926060348749161, 0.07173185795545578, 0.01593470387160778, 0.012744410894811153, -0.0018597590969875455, -0.025316912680864334, -0.010907981544733047, -0.005005326587706804, -0.01968817412853241, 0.033484138548374176, 0.006714820396155119, -0.010639655403792858, -0.01092666294425726, -0.045950863510370255, 0.012692313641309738, 0.000918569799978286, -0.02490442804992199, -0.01607189141213894, -0.021443312987685204, 0.049049507826566696, 0.03338436782360077, -0.008994657546281815, -0.002996227703988552, -0.06738949567079544, 0.022135667502880096, -0.00972834974527359, -0.029039064422249794, -0.03589697927236557, 0.001610345090739429, -0.014937298372387886, -0.012339090928435326, 0.02554517798125744, 0.046193014830350876, -0.004345365334302187, 0.01365199126303196, -0.001699392101727426, 0.012620942667126656, 0.014717362821102142, -0.002887594047933817, 0.030459079891443253, 0.020319512113928795, -0.023096008226275444, 0.0062515269964933395, 0.05071757361292839, -0.013483187183737755, -0.03720557689666748, 0.02292444556951523, 0.02687659114599228, 0.03029818832874298, 0.021761959418654442, 0.05365673825144768, 0.029040800407528877, 0.029853107407689095, -0.02603922039270401, -0.20196866989135742, 0.012846739962697029, 0.030723491683602333, -0.01732422225177288, -0.0199876818805933, -0.07141651958227158, 0.002562078880146146, -0.010790234431624413, -0.00912878755480051, 0.012701112776994705, 0.08112859725952148, 0.02785903587937355, -0.02790902741253376, -0.02480272576212883, -0.029429486021399498, -0.01075771450996399, -0.01502892654389143, -0.017183881253004074, -0.05196020007133484, -0.012419912032783031, 0.00884526502341032, 0.01844613440334797, 0.002548890421167016, -0.021848976612091064, 0.03264501318335533, 0.01179743092507124, 0.13960427045822144, -0.025144530460238457, 0.03468981385231018, -0.021895142272114754, -0.02117186412215233, 0.016584031283855438, -0.018765218555927277, -0.054703239351511, 0.025059854611754417, -0.016374722123146057, 0.016123849898576736, -0.003708566538989544, -0.04133957624435425, -0.00849760603159666, -0.028434859588742256, 0.04726102575659752, -0.014207079075276852, -0.047314103692770004, -0.04426546022295952, 0.01351428683847189, -0.029985584318637848, 0.029003139585256577, -0.06406758725643158, 0.01731088012456894, 0.007897155359387398, 0.003896727692335844, 0.03251206502318382, -0.015307789668440819, -0.0070801423862576485, -0.010309780947864056, -0.11112439632415771, 0.0012226372491568327, -0.061882954090833664, 0.01632481999695301, 0.00926218181848526, -0.027621112763881683, 0.045402154326438904, -0.045984067022800446, 0.004757782444357872, -0.05488351359963417, -0.006975778844207525, -0.02643108181655407, 0.009531687945127487, -0.027858160436153412, -0.025595730170607567, 0.0744604617357254, -0.025478288531303406, -0.0059356666170060635, 0.05211775749921799, -0.007892584428191185, -0.013405599631369114, -0.04314378648996353, -0.049202971160411835, -0.0059571536257863045, 0.0488767996430397, -0.024107331410050392, 0.02697221376001835, 0.024387886747717857, 0.039040107280015945, 0.00032545323483645916, 0.014925317838788033, 0.01634179800748825, 0.006510063540190458, 0.00361048080958426, -0.052958134561777115, -0.02088373899459839, -0.016529442742466927, -0.014343922957777977, 0.027781831100583076, -0.0017159103881567717, -0.3017254173755646, 0.01681540533900261, -0.00700282072648406, 0.010597601532936096, -0.007129952311515808, -0.007546112406998873, -0.009888174012303352, -0.03493884205818176, 0.01170005090534687, 0.011879476718604565, 0.03627112880349159, 0.04533794894814491, 0.06607098877429962, -0.015241232700645924, -0.014076337218284607, 0.015494550578296185, 0.08697167038917542, -0.021416081115603447, 0.019645432010293007, 0.008107849396765232, 0.024905065074563026, -0.01863640919327736, 0.13659891486167908, -0.05241827666759491, -0.008291631937026978, 0.020772341638803482, 0.028437308967113495, -0.009829279035329819, 0.013206793926656246, 0.021955015137791634, 0.028175923973321915, 0.012128883972764015, 0.033112671226263046, 0.004154402296990156, 0.024991588667035103, 0.033580292016267776, -0.026486480608582497, 0.042412735521793365, 0.029732465744018555, 0.005973535589873791, 0.03689033165574074, 0.01741745136678219, 0.011772974394261837, -0.014456392265856266, 0.04207569733262062, -0.01978430338203907, 0.0017289434326812625, -0.023392383009195328, -0.028558999300003052, 0.030301861464977264, -0.012767212465405464, -0.0019541303627192974, 0.01591140404343605, 0.0013450987171381712, 0.058671917766332626, 0.021037207916378975, 0.007109987549483776, -0.018380548804998398, 0.00623488612473011, -0.049159109592437744, -0.0006347575108520687, -0.056262578815221786, 0.025813011452555656, 0.036616187542676926, 0.01238677091896534]}, "README.md": {"content": "# \ud83c\udfe5 Patient Risk Prediction \u2014 End-to-End Analytics Project\n\n**Author:** Suleman Ali  \n**Date:** 2025-10-28  \n\n---\n\n## \ud83d\udcd8 Table of Contents\n1. [Project Overview](#project-overview)  \n2. [Architecture & Data Flow](#architecture--data-flow)  \n3. [Data Lineage](#data-lineage)  \n4. [Conceptual Mapping to Clinical Tables](#conceptual-mapping-to-clinical-tables)  \n5. [Gold Layer Models](#gold-layer-models)  \n6. [ETL Summary](#etl-summary)  \n7. [Power BI Analytics & Visualization](#power-bi-analytics--visualization)  \n8. [Next Steps (Planned)](#next-steps-planned)  \n9. [Notes](#notes)  \n\n---\n\n## \ud83e\udde9 Project Overview\n\nThis project implements a complete **data engineering and analytics solution** for patient risk prediction using the [Healthcare Dataset](https://www.kaggle.com/datasets/prasad22/healthcare-dataset).\n\n### Goals:\n- Clean and model healthcare data (Patients, Diagnoses, Treatments, Outcomes)  \n- Build ETL pipelines using **Databricks + dbt**  \n- Design an **interactive Power BI dashboard** for hospital analytics  \n- Extend with predictive modeling and Gen-AI chatbot  \n\n---\n\n## \ud83e\uddf1 Architecture & Data Flow\n\n| Layer | Platform | Description |\n|--------|-----------|-------------|\n| **Bronze** | Databricks | Raw ingestion of healthcare dataset |\n| **Silver** | Databricks | Data cleaning, encoding, and transformation |\n| **Gold** | dbt + Databricks | Dimensional modeling for Power BI consumption |\n| **BI** | Power BI | Dashboards for operational and clinical analytics |\n\n---\n\n## \ud83e\udded Data Lineage\n\n```mermaid\ngraph TD\n    subgraph Bronze Layer [Databricks - Bronze]\n        bronze_healthcare[\"bronze.healthcare\"]\n    end\n\n    subgraph Silver Layer [Databricks - Silver]\n        silver_healthcare[\"silver.healthcare\"]\n    end\n\n    subgraph Gold Layer [dbt - Gold]\n        dim_patient[\"dim_patient\"]\n        dim_doctor[\"dim_doctor\"]\n        dim_hospital[\"dim_hospital\"]\n        dim_date[\"dim_date\"]\n        fact_admissions[\"fact_admissions\"]\n        fact_billing_summary[\"fact_billing_summary\"]\n        doctor_billing_summary[\"doctor_billing_summary\"]\n        vw_high_risk_patients[\"vw_high_risk_patients\"]\n        vw_avg_stay_by_hospital[\"vw_avg_stay_by_hospital\"]\n        vw_total_billing_by_insurance[\"vw_total_billing_by_insurance\"]\n        vw_patient_summary[\"vw_patient_summary\"]\n    end\n\n    bronze_healthcare --> silver_healthcare\n    silver_healthcare --> dim_patient\n    silver_healthcare --> dim_doctor\n    silver_healthcare --> dim_hospital\n    silver_healthcare --> dim_date\n    silver_healthcare --> fact_admissions\n    silver_healthcare --> fact_billing_summary\n    silver_healthcare --> doctor_billing_summary\n\n    dim_patient --> fact_admissions\n    dim_doctor --> fact_admissions\n    dim_hospital --> fact_admissions\n    dim_date --> fact_admissions\n\n    fact_admissions --> vw_high_risk_patients\n    fact_billing_summary --> vw_total_billing_by_insurance\n    fact_admissions --> vw_avg_stay_by_hospital\n    fact_admissions --> vw_patient_summary\n    fact_billing_summary --> vw_patient_summary\n```\n\n---\n\n## \ud83e\udde0 Conceptual Mapping to Clinical Tables\n\n| Conceptual Table | Implemented In | Description |\n|------------------|----------------|-------------|\n| **Patients** | `dim_patient`, `vw_patient_summary` | Patient demographics, insurance, identifiers |\n| **Diagnoses** | `vw_high_risk_patients` | Diagnosis and risk assessment |\n| **Treatments** | `vw_patient_summary` | Admission, doctor, and treatment information |\n| **Outcomes** | `vw_high_risk_patients`, `fact_billing_summary` | Stay duration, discharge, billing, and outcomes |\n\n---\n\n## \ud83e\uddf1 Gold Layer Models\n\n| Type | Model | Description |\n|-------|--------|-------------|\n| **Dimension** | `dim_patient` | Patient demographics |\n| **Dimension** | `dim_doctor` | Doctor details |\n| **Dimension** | `dim_hospital` | Hospital metadata |\n| **Dimension** | `dim_date` | Calendar attributes |\n| **Fact** | `fact_admissions` | Admissions and stay data |\n| **Fact** | `fact_billing_summary` | Hospital billing metrics |\n| **Fact** | `doctor_billing_summary` | Doctor-level billing & admissions |\n| **View** | `vw_high_risk_patients` | Risk classification view |\n| **View** | `vw_avg_stay_by_hospital` | Avg stay by hospital |\n| **View** | `vw_total_billing_by_insurance` | Billing by insurer |\n| **View** | `vw_patient_summary` | Consolidated patient-level data |\n\n---\n\n## \u2699\ufe0f ETL Summary\n\n| Step | Task | Tools |\n|-------|------|-------|\n| **1. Data Ingestion** | Import raw CSV from Kaggle | Databricks (Bronze) |\n| **2. Data Cleaning** | Handle nulls, format columns | PySpark (Silver) |\n| **3. Data Modeling** | Star schema, fact/dim design | dbt (Gold) |\n| **4. Data Validation** | Run dbt tests (unique, not_null, relationships) | dbt tests |\n| **5. Analytics Layer** | Build dashboards | Power BI |\n\n---\n\n## \ud83d\udcca Power BI Analytics & Visualization  \n\n### \ud83c\udfaf Dashboard Pages Overview  \n\n| Page | Purpose | Key Visuals |\n|------|----------|-------------|\n| **Home (Summary KPIs)** | Executive overview | KPIs: Admissions, Billing, Avg Stay, Risk % |\n| **Patient Insights** | Patient demographics | Age, Gender, Insurance, Risk by Group |\n| **Hospital Performance** | Hospital-level metrics | Avg Stay, Risk %, Admissions Trend |\n| **Doctor Insights** | Doctor performance | Avg Stay Weighted, Top Doctors, Billing Efficiency |\n| **Billing & Insurance** | Financial analytics | Billing by Insurance, % Share, Monthly Trends |\n| **Date Trends** | Time-based analysis | Admissions, Billing, Risk, Avg Stay Trends |\n\n---\n\n### \ud83d\uddbc\ufe0f Dashboard Previews  \n\n#### \ud83c\udfe0 Home (Summary KPIs)\n![Home Dashboard](powerbi/assets/home_summary.png)\n\n#### \ud83d\udc69\u200d\u2695\ufe0f Patient Insights\n![Patient Insights](powerbi/assets/patient_insights.png)\n\n#### \ud83c\udfe5 Hospital Performance\n![Hospital Performance](powerbi/assets/hospital_performance.png)\n\n#### \ud83d\udc68\u200d\u2695\ufe0f Doctor Insights\n![Doctor Insights](powerbi/assets/doctor_insights.png)\n\n#### \ud83d\udcb0 Billing & Insurance\n![Billing & Insurance](powerbi/assets/billing_insurance.png)\n\n#### \ud83d\udcc5 Date Trends\n![Date Trends](powerbi/assets/date_trends.png)\n\n---\n\n### \ud83e\uddee Key DAX Measures\n\n```DAX\nTotal Admissions = SUM(fact_admissions[total_admissions])\nTotal Billing = SUM(fact_billing_summary[billing_amount])\nAvg Stay Duration = AVERAGE(fact_admissions[avg_stay_duration])\n% High-Risk Patients = \nDIVIDE(\n    CALCULATE(COUNTROWS(vw_high_risk_patients), vw_high_risk_patients[risk_level] = \"High\"),\n    COUNTROWS(vw_high_risk_patients),\n    0\n)\n% Billing Share by Insurance =\nDIVIDE(\n    [Total Billing],\n    CALCULATE([Total Billing], ALL(vw_total_billing_by_insurance)),\n    0\n)\n```\n---\n\n## \ud83c\udfa8 Design Highlights\n\n- Unified dark-light theme with gradient cards  \n- Consistent slicers (Year, Month, Hospital, Insurance)  \n- Drill-through navigation to **Patient Details**  \n- KPI indicators with dynamic icons and color states \n\n---\n### \ud83e\udd16 Machine Learning Models\n## \ud83c\udfaf Objective\n\n- Two predictive models were developed using Delta tables as inputs:\n- Classification Model \u2192 Predict whether a patient will be readmitted within 30 days\n- Regression Model \u2192 Predict the expected hospital stay duration (in days)\n\n\u2699\ufe0f Workflow\n| Step                  | Task                                                                        | Tools              |\n| --------------------- | --------------------------------------------------------------------------- | ------------------ |\n| **1. Data Source**    | Delta tables from `ml.patient_readmission_30d` and `ml.stay_duration`       | Databricks SQL     |\n| **2. Data Prep**      | Encoding, scaling, and feature selection                                    | scikit-learn       |\n| **3. Model Training** | Logistic Regression (classification) and Linear Regression (regression)     | sklearn            |\n| **4. Evaluation**     | Precision, Recall, F1, ROC-AUC (classification); MAE, RMSE, R\u00b2 (regression) | sklearn.metrics    |\n| **5. Visualization**  | Compare before & after scaled datasets and actual vs predicted outputs      | pandas, matplotlib |\n---\n\n\ud83e\uddee Classification \u2014 Readmission Prediction (30 Days)\n```\n# Logistic Regression Model\nmodel = LogisticRegression()\nmodel.fit(X_train_scaled, y_train)\n\npreds = model.predict(X_test_scaled)\nprint(classification_report(y_test, preds))\nprint(\"ROC-AUC:\", roc_auc_score(y_test, preds))\n```\n\n# Key Metrics:\n- Accuracy: ~0.99\n- ROC-AUC: 0.50 (imbalanced class \u2014 majority of patients not readmitted)\n- Notes: Consider oversampling techniques (SMOTE) for better class balance\n\n## \ud83d\udcc8 Regression \u2014 Stay Duration Prediction\n```\n# Linear Regression Model\nmodel = LinearRegression()\nmodel.fit(X_train_scaled, y_train)\n\npreds = model.predict(X_test_scaled)\nmae = mean_absolute_error(y_test, preds)\nmse = mean_squared_error(y_test, preds)\nrmse = np.sqrt(mse)\nr2 = r2_score(y_test, preds)\n```\n\n## Model Performance:\n\n| Metric   | Description                  | Example Result |\n| -------- | ---------------------------- | -------------- |\n| **MAE**  | Mean Absolute Error          | 1.42           |\n| **MSE**  | Mean Squared Error           | 3.84           |\n| **RMSE** | Root Mean Square Error       | 1.96           |\n| **R\u00b2**   | Coefficient of Determination | 0.87           |\n\n## \ud83d\udcca Example Visualization\n| Actual Stay | Predicted Stay |\n| ----------- | -------------- |\n| 14          | 13.8           |\n| 22          | 21.5           |\n| 7           | 7.3            |\n| 10          | 9.7            |\n\n---\n## \ud83d\udca1 Insights\n- The regression model achieved strong correlation (R\u00b2 \u2248 0.87).\n- Classification model indicates need for data rebalancing or additional patient history features.\n- Future versions will integrate model outputs into Power BI dashboards via Delta Live Tables.\n\n---\n## \ud83d\udd2e Next Steps\n1. Add ML model (readmission prediction, stay duration regression).\n2. Integrate chatbot (natural language analytics).\n3. Deploy ML models as REST APIs for Power BI integration.\n\n---\n## \ud83e\uddfe Notes\n- Surrogate keys (_sk) generated via deterministic MD5 hashing.\n- dbt tests: unique, not_null, relationships enforced.\n- Relationships structured in a star schema for optimal Power BI performance.\n\n```\n\ud83d\udcc2 Repository Structure\n\u251c\u2500\u2500 chatbot/\n\u251c\u2500\u2500 databricks/\n\u2502   \u251c\u2500\u2500 bronze/\n\u2502   \u251c\u2500\u2500 silver/\n\u2502   \u2514\u2500\u2500 gold/\n\u251c\u2500\u2500 ml/\n\u2502   \u251c\u2500\u2500 patient_readmission_30d_notebook.ipynb\n\u2502   \u2514\u2500\u2500 stay_duration_notebook.ipynb\n\u251c\u2500\u2500 dbt/\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2514\u2500\u2500 dbt_project.yml\n\u251c\u2500\u2500 powerbi/\n\u2502   \u251c\u2500\u2500 Patient_Risk_Prediction.pbix\n\u2502   \u2514\u2500\u2500 assets/\n\u2502       \u251c\u2500\u2500 home_summary.png\n\u2502       \u251c\u2500\u2500 patient_insights.png\n\u2502       \u251c\u2500\u2500 hospital_performance.png\n\u2502       \u251c\u2500\u2500 doctor_insights.png\n\u2502       \u251c\u2500\u2500 billing_insurance.png\n\u2502       \u2514\u2500\u2500 date_trends.png\n\u2514\u2500\u2500 README.md\n```\n", "embedding": [-0.040600746870040894, -0.013907849788665771, 0.009889800101518631, -0.00904531218111515, 0.00020008158753626049, 0.014459758065640926, -0.004169156774878502, 0.020645858719944954, 0.02101961150765419, 7.449645636370406e-05, 0.03266015276312828, -0.04430728033185005, -0.00010934135934803635, 0.03515780344605446, 0.012166409753262997, 0.03413454815745354, 0.013480102643370628, 0.009785976260900497, 0.005267222411930561, 0.04426436498761177, 0.018148092553019524, -0.02739477902650833, 0.0050717368721961975, -0.044376540929079056, -0.012716737575829029, 0.03659450262784958, 0.0018276231130585074, -0.053437016904354095, -0.0045211827382445335, -0.22678638994693756, -0.01517655048519373, 0.006842079106718302, 0.04040159285068512, -0.03012777864933014, -0.01159608457237482, -0.01935661770403385, 0.008875884115695953, 0.06357648223638535, -0.03740697726607323, 0.004768386483192444, -0.01612061634659767, -0.008731546811759472, 0.0023930042516440153, 0.009030208922922611, 0.021026095375418663, -0.02452176623046398, -0.026253821328282356, -0.03111906535923481, -0.01723487861454487, 0.022962793707847595, 0.013811205513775349, 0.0023660508450120687, -0.012452243827283382, 0.061482369899749756, 0.03522186726331711, -0.007722081150859594, 0.04040494188666344, 0.03239842504262924, 0.010322898626327515, 0.02301083132624626, 0.008813310414552689, 0.035396646708250046, -0.17341522872447968, 0.008213580586016178, 0.013146345503628254, 0.03567705303430557, -0.04207263141870499, -0.037144117057323456, 0.024646911770105362, 0.043671391904354095, -0.003662576898932457, -0.0032174133230000734, 0.014271307736635208, 0.022727711126208305, 0.01402915921062231, 0.014244467951357365, 0.038016438484191895, -0.010008055716753006, 0.022098449990153313, 0.01352156326174736, 0.008234823122620583, 0.026251111179590225, -0.01695007085800171, -0.011709179729223251, -0.023187069222331047, -0.015190048143267632, -0.010684111155569553, -0.02266259491443634, -0.005442909896373749, 0.004994639195501804, -0.02486966736614704, -0.011959375813603401, -0.020597347989678383, 0.008544688113033772, -0.06666073203086853, -0.00868598185479641, 0.004192429129034281, -0.02584456093609333, -0.04419432953000069, 0.6360092163085938, -0.026098916307091713, -0.0046638501808047295, -0.0035608529578894377, -0.04268943518400192, 0.020150214433670044, -0.044059377163648605, -0.010412614792585373, -0.02363548055291176, -0.009635675698518753, -0.030536772683262825, -0.01168149895966053, -0.01775311306118965, 0.07415710389614105, -0.04336119070649147, 0.016209129244089127, 0.026601795107126236, 0.028193097561597824, 0.040104079991579056, 0.01866564340889454, -0.006425906904041767, -0.03283976390957832, 0.01480691134929657, 0.025419926270842552, -0.003453782992437482, -0.0042033204808831215, -0.05837393179535866, 0.028958868235349655, 0.06137947365641594, 0.0230745617300272, -0.004074231255799532, 0.046792030334472656, 0.006362282671034336, -0.0654134526848793, 0.01422700472176075, -0.0011308620451018214, -0.0169820636510849, 0.02235966920852661, -0.023383500054478645, 0.003173375502228737, -0.005841371603310108, 0.011234222911298275, -0.018086595460772514, 0.0022817666176706553, -0.07642167061567307, -0.06719920784235, 0.10560722649097443, 0.015734931454062462, -0.013101190328598022, -0.04851152375340462, -0.05598443001508713, 0.029852375388145447, 0.06631996482610703, -0.012727917172014713, 0.00812482088804245, -0.009658178314566612, 0.04355411231517792, 0.028937023133039474, 0.004104592837393284, -0.07422170042991638, 0.019663885235786438, -0.004522993694990873, -0.018608175218105316, -0.05078984797000885, 0.07952623069286346, 0.016871485859155655, -0.09810161590576172, -0.011997153051197529, 0.006268782075494528, 0.019708100706338882, -0.0090580303221941, 0.040923383086919785, 0.012024585157632828, 0.0006982496124692261, -0.024499008432030678, 0.006238225847482681, 0.03099476359784603, 0.011414220556616783, -0.04887106269598007, -0.00780883664265275, 0.005233217030763626, 0.019802019000053406, 0.010949376039206982, -0.038890499621629715, 0.016879143193364143, -0.03202098608016968, -0.027012286707758904, 0.001762169529683888, 0.012193305417895317, 0.03730030357837677, 0.042472779750823975, -0.0297181885689497, 0.03515489026904106, -0.05749716982245445, 0.042670998722314835, -0.01281051803380251, -0.03342641890048981, -0.045364342629909515, -0.028668107464909554, -0.01798405684530735, 0.0018489242065697908, 0.015819001942873, 0.031293489038944244, -0.0063347057439386845, 0.03659975901246071, -0.0010006012162193656, 0.018107376992702484, -0.0004753743123728782, -0.011421382427215576, 0.005913179833441973, 0.014092311263084412, -0.007780328392982483, -0.006242702715098858, 0.048723261803388596, 0.022203728556632996, -0.03550027310848236, 0.007642070762813091, 0.011863892897963524, 0.017279036343097687, 0.02635142207145691, 0.062055088579654694, 0.008058460429310799, 0.04843004047870636, -0.05664783716201782, -0.2089979350566864, 0.008754265494644642, 0.0040673064067959785, -0.02303846925497055, -0.015449333004653454, -0.03757734224200249, 0.002169014187529683, -0.02948209084570408, -0.0053601996041834354, 0.023770811036229134, 0.09364019334316254, 0.027843201532959938, -0.049839455634355545, -0.014482312835752964, -0.018203310668468475, 0.011061521247029305, 0.01276677381247282, -0.025445356965065002, -0.07983294129371643, -0.02353285439312458, -0.01447534654289484, 0.0095180943608284, 0.013333569280803204, -0.053814295679330826, 0.01634988933801651, 0.02085079997777939, 0.12218479812145233, -0.010125759989023209, 0.0012225925456732512, -0.00814145989716053, -0.008712578564882278, 0.007966144941747189, -0.01588481478393078, -0.08316256105899811, 0.04554899409413338, -0.008014990948140621, 0.03261738270521164, 0.02517091855406761, -0.05563171207904816, -0.009339984506368637, -0.06970849633216858, 0.026761608198285103, -0.02098029851913452, -0.06529683619737625, -0.038032907992601395, 0.0020317703019827604, -0.019905395805835724, 0.006867164745926857, -0.04532475024461746, 0.027416834607720375, 0.013585405424237251, -0.041207440197467804, 0.049073122441768646, -0.010210253298282623, 0.01110051665455103, -0.017909390851855278, -0.053875066339969635, 0.02433028258383274, -0.022745486348867416, 0.011990826576948166, -0.0007428255048580468, -0.012326611205935478, -0.006422398611903191, -0.007368393242359161, 0.016523508355021477, -0.04825989156961441, 0.006753650959581137, -0.006595876067876816, 0.0074737900868058205, -0.011578286066651344, -0.0340556725859642, 0.09859497845172882, -0.04516417533159256, -0.033656489104032516, 0.028056439012289047, 0.0102637754753232, 0.0025814168620854616, -0.05209336057305336, -0.03257432579994202, 0.009136260487139225, 0.033550769090652466, -0.016307229176163673, 0.03336048498749733, 0.016087733209133148, 0.02467365376651287, 0.00805263128131628, 0.027485456317663193, -0.006376747507601976, 0.02407134510576725, -0.0076352814212441444, -0.013165824115276337, -0.035363662987947464, -0.03050812892615795, -0.014706596732139587, 0.017854489386081696, 0.03581446409225464, -0.2862672507762909, 0.03678577393293381, -0.017720093950629234, 0.0562969334423542, -0.0077737364917993546, -0.02537618577480316, 0.018448464572429657, -0.03563759848475456, 0.013940585777163506, 0.027220770716667175, 0.018544496968388557, 0.030171269550919533, 0.08251605182886124, -0.0032206724863499403, 0.011929756961762905, -0.01881290040910244, 0.07978563010692596, -0.04480348154902458, 0.022274870425462723, 0.0383908674120903, 0.025065898895263672, -0.018023468554019928, 0.15241791307926178, -0.0009043000172823668, 0.011238104663789272, 0.01405183132737875, -0.014292501844465733, -0.015907010063529015, -0.0064056566916406155, 0.02992861159145832, -0.026972373947501183, -0.006362325511872768, 0.04062522202730179, -0.000760219874791801, 0.037106648087501526, 0.03719348460435867, -0.018319280818104744, 0.022459497675299644, -0.0005207562353461981, -0.005214530508965254, 0.041778188198804855, 0.012770786881446838, 0.005611288361251354, 0.008615287020802498, 0.022851411253213882, -0.017768429592251778, -0.0038703030440956354, -0.025212371721863747, -0.0030819689854979515, 0.010630717501044273, -0.005244784988462925, -0.011540194973349571, -0.03789490833878517, 0.001434090780094266, 0.026682162657380104, 0.0333302840590477, 0.0014070774195715785, -0.029395828023552895, 0.012927117757499218, -0.05320606008172035, -0.0021470561623573303, 0.001294345478527248, -0.020085347816348076, 0.01998222805559635, 0.005632000043988228]}}